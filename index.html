<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Safe-Cycling Reporter</title>
<style>
  :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --acc:#22c55e; --danger:#ef4444; --warn:#f59e0b; --text:#e5e7eb; }
  *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#0b1224,#0f172a);}
  .wrap{max-width:900px;margin:40px auto;padding:20px}
  .card{background:rgba(17,24,39,.7);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:20px;backdrop-filter: blur(6px);box-shadow:0 10px 35px rgba(0,0,0,.35)}
  h1{color:#fff;margin:0 0 8px;font-size:28px}
  p.sub{color:var(--muted);margin:0 0 18px}
  label{display:block;color:var(--text);margin:12px 0 6px}
  input[type="text"], select, textarea{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0b1020;color:#e5e7eb}
  input[type="file"]{border:1px dashed rgba(255,255,255,.25);padding:16px;border-radius:12px;width:100%;color:var(--muted);background:#0b1020}
  button{appearance:none;border:0;border-radius:12px;padding:14px 16px;background:linear-gradient(90deg,#3b82f6,#22c55e);color:#fff;font-weight:600;cursor:pointer}
  .grid{display:grid;gap:16px;grid-template-columns:1fr}
  .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
  .preview{margin-top:12px;border-radius:14px;overflow:hidden;border:1px solid rgba(255,255,255,.08)}
  .preview img{width:100%;display:block}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#0b1020;border:1px solid rgba(255,255,255,.1);color:#cbd5e1;font-size:12px}
  .result{margin-top:14px;padding:14px;border-radius:12px;background:#0b1020;border:1px solid rgba(255,255,255,.08);color:#dbeafe}
  .sev-low{border-left:6px solid var(--acc)} .sev-mid{border-left:6px solid var(--warn)} .sev-high{border-left:6px solid var(--danger)}
  .foot{margin-top:16px;color:var(--muted);font-size:13px}
  .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
  a.btn{padding:10px 12px;border-radius:10px;background:#111827;border:1px solid rgba(255,255,255,.1);color:#e5e7eb;text-decoration:none}
</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <h1>Safe-Cycling Reporter</h1>
        <p class="sub">Snap a hazard → AI classifies → Auto-report for council</p>
      </div>
      <a class="btn" href="dashboard.html">Open Dashboard</a>
    </div>

    <div class="card">
      <div class="grid">
        <div>
          <label>1) Upload photo (pothole / debris / crack)</label>
          <input id="photo" type="file" accept="image/*" />
          <div class="preview" id="preview" hidden><img id="previewImg" alt="preview"/></div>
        </div>

        <div class="row">
          <div>
            <label>2) Location</label>
            <input id="location" type="text" placeholder="e.g., 123 King St, Sydney NSW" />
          </div>
          <div>
            <label>3) Hazard type (optional)</label>
            <select id="type">
              <option value="">Auto-detect</option>
              <option>Pothole</option>
              <option>Debris</option>
              <option>Surface crack</option>
              <option>Drain grate hazard</option>
            </select>
          </div>
        </div>

        <div>
          <label>Notes (optional)</label>
          <textarea id="notes" rows="3" placeholder="Short note…"></textarea>
        </div>

        <div>
          <button id="submit">Submit Hazard</button>
          <span class="pill" id="status" style="margin-left:8px;"></span>
        </div>

        <div id="aiBox" class="result" hidden></div>
      </div>
      <p class="foot">Demo only · No data leaves your browser · Uses localStorage</p>
    </div>
  </div>

<script>
const el = s => document.querySelector(s);
const photo = el('#photo'), preview = el('#preview'), previewImg = el('#previewImg');
const statusPill = el('#status'), aiBox = el('#aiBox');

photo.addEventListener('change', e=>{
  const file = e.target.files?.[0]; if(!file) return;
  const url = URL.createObjectURL(file);
  previewImg.src = url; preview.hidden = false;
});

function fakeClassify(nameHint, noteText){
  // really simple heuristic + randomness for demo
  const text = (nameHint + ' ' + noteText).toLowerCase();
  let type = 'Pothole';
  if(text.includes('glass')||text.includes('debris')) type='Debris';
  else if(text.includes('crack')) type='Surface crack';
  else if(text.includes('grate')) type='Drain grate hazard';

  // severity: weight certain keywords and “size”
  let sevScore = 0.5 + Math.random()*0.5;
  if(text.includes('deep')||text.includes('large')) sevScore += 0.2;
  if(text.includes('lane')||text.includes('bike')) sevScore += 0.1;
  if(text.includes('small')||text.includes('minor')) sevScore -= 0.2;
  sevScore = Math.max(0, Math.min(1, sevScore));

  let sevLabel='Medium', sevClass='sev-mid';
  if(sevScore >= 0.75){ sevLabel='High'; sevClass='sev-high'; }
  else if(sevScore <= 0.45){ sevLabel='Low'; sevClass='sev-low'; }

  return { type, sevLabel, sevClass, sevScore: Math.round(sevScore*100) };
}

function llmReport({type, sevLabel, sevScore}, loc, notes){
  const ts = new Date().toLocaleString();
  const noteStr = notes ? ` Notes: ${notes.trim()}` : '';
  const rec = (sevLabel==='High') ? 'Urgent patch within 48 hours.'
           : (sevLabel==='Medium') ? 'Schedule repair in next maintenance cycle.'
           : 'Monitor and include in routine maintenance.';
  return `Hazard Report — ${ts}
Location: ${loc || 'Location not provided'}
Hazard: ${type}
Risk: ${sevLabel} (${sevScore}% confidence)
Recommendation: ${rec}${noteStr}`;
}

function saveReport(rec){
  const key='scr_reports_v1';
  const list = JSON.parse(localStorage.getItem(key) || '[]');
  list.unshift(rec);
  localStorage.setItem(key, JSON.stringify(list));
}

el('#submit').addEventListener('click', async ()=>{
  statusPill.textContent='Processing…';
  const loc = el('#location').value.trim();
  const hint = el('#type').value.trim();
  const notes = el('#notes').value.trim();

  // simulate AI latency
  await new Promise(r=>setTimeout(r, 600));
  const cls = fakeClassify(hint, notes);
  const report = llmReport(cls, loc, notes);

  aiBox.hidden = false;
  aiBox.className = `result ${cls.sevClass}`;
  aiBox.textContent = `AI: ${cls.type} · Severity: ${cls.sevLabel} (${cls.sevScore}%)\n\n${report}`;

  // persist to "backend"
  const file = photo.files?.[0];
  let imgData=null;
  if(file){
    imgData = await new Promise(res=>{
      const reader = new FileReader();
      reader.onload = e=>res(e.target.result);
      reader.readAsDataURL(file);
    });
  }

  saveReport({
    id: 'SCR-' + Math.random().toString(36).slice(2,8).toUpperCase(),
    when: new Date().toISOString(),
    loc, notes,
    ai: cls, report,
    img: imgData
  });

  statusPill.textContent='Submitted ✓  (view in Dashboard)';
});
</script>
</body>
</html>
