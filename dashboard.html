<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Safe-Cycling Dashboard</title>
<style>
  :root { --bg:#0f172a; --card:#0b1020; --muted:#94a3b8; --text:#e5e7eb; --acc:#22c55e; --warn:#f59e0b; --danger:#ef4444}
  body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#0b1224,#0f172a);color:var(--text)}
  .wrap{max-width:1100px;margin:40px auto;padding:20px}
  .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  a.btn{padding:10px 12px;border-radius:10px;background:#111827;border:1px solid rgba(255,255,255,.1);color:#e5e7eb;text-decoration:none}
  .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:16px 0}
  .kpi{background:rgba(17,24,39,.7);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px}
  .kpi h3{margin:0 0 6px;font-size:13px;color:#cbd5e1;font-weight:600;text-transform:uppercase;letter-spacing:.06em}
  .kpi .val{font-size:26px;font-weight:700}
  .list{margin-top:10px;display:grid;gap:12px}
  .row{display:grid;grid-template-columns:120px 1fr;gap:12px;background:rgba(17,24,39,.7);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:12px}
  .thumb{width:120px;height:90px;background:#0b1020;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center}
  .thumb img{width:120px;height:90px;object-fit:cover}
  .sev{font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.15)}
  .sev.High{background:rgba(239,68,68,.12);color:#fecaca;border-color:rgba(239,68,68,.35)}
  .sev.Medium{background:rgba(245,158,11,.12);color:#fde68a;border-color:rgba(245,158,11,.35)}
  .sev.Low{background:rgba(34,197,94,.12);color:#bbf7d0;border-color:rgba(34,197,94,.35)}
  .meta{color:#93c5fd;font-size:12px}
  .report{white-space:pre-wrap;color:#e5e7eb;font-size:13px;margin-top:6px}
  .empty{opacity:.7;border:1px dashed rgba(255,255,255,.25);padding:22px;text-align:center;border-radius:16px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1 style="margin:0">Council Dashboard</h1>
        <div style="color:#94a3b8">Prioritised cyclist hazard reports (demo)</div>
      </div>
      <a class="btn" href="index.html">← Reporter</a>
    </div>

    <div class="stats">
      <div class="kpi"><h3>Total Reports</h3><div class="val" id="kTotal">0</div></div>
      <div class="kpi"><h3>High Severity</h3><div class="val" id="kHigh">0</div></div>
      <div class="kpi"><h3>Median Confidence</h3><div class="val" id="kConf">—</div></div>
    </div>

    <div id="list" class="list"></div>
    <div id="empty" class="empty" hidden>No reports yet. Open the Reporter page and submit one.</div>
  </div>

<script>
function getReports(){
  const key='scr_reports_v1';
  return JSON.parse(localStorage.getItem(key) || '[]');
}
function median(nums){
  if(!nums.length) return null;
  const a=[...nums].sort((x,y)=>x-y);
  const mid=Math.floor(a.length/2);
  return (a.length%2)? a[mid] : Math.round((a[mid-1]+a[mid])/2);
}
function render(){
  const list = getReports();
  const listEl = document.getElementById('list');
  const empty = document.getElementById('empty');
  listEl.innerHTML = '';

  if(!list.length){ empty.hidden=false; return; }
  empty.hidden=true;

  // KPIs
  document.getElementById('kTotal').textContent = list.length;
  document.getElementById('kHigh').textContent = list.filter(r=>r.ai.sevLabel==='High').length;
  const med = median(list.map(r=>r.ai.sevScore));
  document.getElementById('kConf').textContent = med!==null ? med+'%' : '—';

  // Sort: High -> Medium -> Low, then newest first
  const order = {High:0, Medium:1, Low:2};
  list.sort((a,b)=>{
    const o = order[a.ai.sevLabel] - order[b.ai.sevLabel];
    if(o!==0) return o;
    return new Date(b.when)-new Date(a.when);
  });

  for(const r of list){
    const row = document.createElement('div');
    row.className='row';
    row.innerHTML = `
      <div class="thumb">${r.img? `<img src="${r.img}" alt="hazard"/>` : '<span style="color:#94a3b8">No image</span>'}</div>
      <div>
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
          <div>
            <strong>${r.ai.type}</strong> • <span class="sev ${r.ai.sevLabel}">${r.ai.sevLabel}</span>
            <div class="meta">${new Date(r.when).toLocaleString()} • ${r.loc || 'Location: —'}</div>
          </div>
          <div style="color:#94a3b8;font-size:12px;">ID: ${r.id}</div>
        </div>
        <div class="report">${r.report}</div>
      </div>
    `;
    listEl.appendChild(row);
  }
}
render();
</script>
</body>
</html>
